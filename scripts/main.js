"use strict";function skewness(e){for(var t,o,n,a,r=0,i=e,s=0,l=0,c=0,u={},d=i.length-1;d>=0;d--)r+=i[d];t=r/i.length;for(var d=i.length-1;d>=0;d--)l=i[d]-t,c+=Math.pow(l,3),s+=Math.pow(l,2);return o=s/(i.length-1),console.log("Variance: "+o),u.variance=o,u.standardDeviation=Math.pow(o,.5),n=c/i.length,console.log("nestedEofX: "+n),0===o?u.skewness=0:(a=n/Math.pow(o,1.5),console.log("Skewness: "+a),u.skewness=a),Math.abs(a)>=1?u.traffic=355*Math.pow(a,2):(console.log("ðŸ˜ž"),u.traffic=355),u}function addProgress(e){progress+=e,$("body").loadie(progress)}function finishProgress(){progress=1,$("body").loadie(progress)}function saveLocal(e,t){localStorage.setItem(e,JSON.stringify(t))}function readLocal(e){var t=JSON.parse(localStorage.getItem(e));return t}function updateLocal(e,t,o){var n=readLocal(e);null===n&&(n={}),n[t]=o,saveLocal(e,n)}function setCookie(e,t,o){if(o!==!1){var n=new Date;n.setTime(n.getTime()+24*o*60*60*1e3);var a="; expires="+n.toGMTString();document.cookie=e+"="+t+a}document.cookie=e+"="+t}function getCookie(e){var t="; "+document.cookie,o=t.split("; "+e+"=");if(2===o.length){var n=o.pop().split(";").shift();return n}}function isInt(e){return!isNaN(e)&&parseInt(Number(e))===e&&!isNaN(parseInt(e,10))}function log(e){var t=readLocal("settings");null!==t&&t.debug===!0&&console.log(e)}function merge_options(e,t){var o={};for(var n in e)o[n]=e[n];for(var n in t)o[n]=t[n];return o}function debug(e){e===!0?updateLocal("settings","debug",!0):updateLocal("settings","debug",!1)}function getId(e){var t=readLocal("feasibility_calc");return"accountId"===e?t.accountId:"propertyId"===e?t.propertyId:"profileId"===e?t.profileId:t}function showError(e,t){swal({title:e,html:!0,text:t,type:"error",confirmButtonText:"Ok :("})}function createReportQuery(e){var t=readLocal("feasibility_calc"),o={viewId:t.profileId,samplingLevel:"LARGE",dateRanges:[{startDate:moment().subtract(28,"days").format("YYYY-MM-DD"),endDate:moment().subtract(1,"days").format("YYYY-MM-DD")}],metrics:e};return o}function authorize(e){addProgress(.13);var t=!e,o={client_id:CLIENT_ID,scope:SCOPES,immediate:t};gapi.auth.authorize(o,function(e){if(log(e),e.error)if(getCookie("fc_auth_count")>=3)showError("Could't authorize.",'<i>Check the console for details</i>.<br />If the problem presists, try some of the following: <ol><li>Try to reload the page</li><li>Clear the cookies for this website</li><li>Revoke the authorization for this app in your <a href="https://security.google.com/settings/security/permissions" target="_blank">Google Settings</a></li></ol>'),console.info(e.error);else{var t=parseInt(getCookie("fc_auth_count"));isInt(t)===!1&&(t=0),t=parseInt(t+1),setCookie("fc_auth_count",t,!1),showAuthDialog()}else e.status.google_logged_in===!0&&log("google logged in"),e.status.signed_in===!0&&log("signed in"),log("Authorized"),addProgress(.13),gapi.client.load("plus","v1",apiClientLoaded),queryAccounts()})}function queryReports(e,t){gapi.client.load(DISCOVERY).then(function(){gapi.client.analyticsreporting.reports.batchGet({reportRequests:[t]}).then(function(e){var t=JSON.stringify(e.result,null,2);document.getElementById("query-output").value=t,$("#go").attr("disabled",!1).html("Go!")}).then(null,function(e){showError("Reporting API Query","Something went wrong using the Reporting API V4.<br /> <b>Check the console for more details (cmd + alt + j).</b>"),console.info(e)})})}function showAuthDialog(){swal({title:"GA Authorization",html:!0,text:"We'll need to premission to access your GA Account.<br /> We won't save any infomation what so ever.",imageUrl:"images/noun_143742_cc.svg",confirmButtonText:"Authorize",confirmButtonColor:"#5cb85c",customClass:"authorize",showCancelButton:!1}),$(".authorize .confirm").click(function(e){$(this).html('<i class="fa fa-cog fa-spin"></i>').attr("disabled",!0),authorize(e)})}function handleAccounts(e){if(addProgress(.13),e.result.items&&e.result.items.length){$("#accountId").html("").attr("disabled",!1),$.each(e.result.items,function(e,t){$("#accountId").append($("<option/>",{value:t.id,text:t.name}))}),finishProgress();var t=readLocal("feasibility_calc");"null"===t||null===t||void 0===t?$("#modalSettings").modal():($("#accountId").val(t.accountId),queryProperties(t.accountId))}else showError("No accounts","No accounts found for this user.")}function queryAccounts(){gapi.client.load("analytics","v3").then(function(){gapi.client.analytics.management.accounts.list().then(handleAccounts)})}function handleProperties(e){if(e.result.items&&e.result.items.length){$("#propertyId").html("").attr("disabled",!1),$.each(e.result.items,function(e,t){$("#propertyId").append($("<option/>",{value:t.id,text:t.name}))});var t=readLocal("feasibility_calc");t.propertyId?($("#propertyId").val(t.propertyId),queryProfiles(t.accountId,t.propertyId)):$("#modalSettings").modal()}else showError("No Properties","No properties found for this user.")}function queryProperties(e){gapi.client.analytics.management.webproperties.list({accountId:e}).then(handleProperties).then(null,function(e){showError("Properties Query","Check the console for more details."),console.info(e)})}function handleProfiles(e){if(e.result.items&&e.result.items.length){$("#profileId").html("").attr("disabled",!1),$.each(e.result.items,function(e,t){$("#profileId").append($("<option/>",{value:t.id,text:t.name}))});var t=readLocal("feasibility_calc");t.profileId?$("#profileId").val(t.profileId):$("#modalSettings").modal(),log(t),$("#go").text("Go!").attr("disabled",!1)}else showError("No Views","No views (profiles) found for this user.")}function queryProfiles(e,t){gapi.client.analytics.management.profiles.list({accountId:e,webPropertyId:t}).then(handleProfiles).then(null,function(e){showError("Profiles Query","Check the console for more details."),console.info(e)})}function presentData(e){$("table").show(),$("#variance").html("<code>"+Number(e.variance).toFixed(2)+"</code>"),$("#standardDeviation").html("<code>"+Number(e.standardDeviation).toFixed(2)+"</code>"),$("#skewness").html("<code>"+Number(e.skewness).toFixed(2)+"</code>"),$("#traffic").html("<code>"+Number(e.traffic).toFixed(2)+"</code>")}function makeArr(e){var t=[];return $.each(e,function(e,o){console.log(o[1]),t.push(parseInt(o[1]))}),console.log(t),skewness(t)}function queryTransactions(){gapi.client.analytics.data.ga.get({ids:"ga:"+getId("profileId"),"start-date":moment().subtract(28,"days").format("YYYY-MM-DD"),"end-date":moment().subtract(1,"days").format("YYYY-MM-DD"),metrics:"ga:transactionRevenue",dimensions:"ga:transactionId",samplingLevel:"HIGHER_PRECISION"}).then(function(e){console.log(e.result.rows);var t=makeArr(e.result.rows);console.log(t),presentData(t)}).then(null,function(e){console.log(e)})}function getFormValues(){var e=$("table.table tbody tr");len=e.length,console.log(len),e.each(function(e){console.log(e);var t=$(this).attr("id"),o=$(this).find("input");queryBounceQuery($(o[0]).val(),t,e)})}function handleEmailResponse(e){if(console.log(e),!e.error){var t;if(e.emails){for(var o=0;o<e.emails.length;o++)"account"===e.emails[o].type&&(t=e.emails[o].value);t&&(fcIdentify(e.displayName,t),hideLoginButton())}}}function apiClientLoaded(){gapi.client.plus.people.get({userId:"me"}).execute(handleEmailResponse)}function fcIdentify(e,t){"undefined"!=typeof analytics&&analytics.identify({name:e,email:t})}function hideLoginButton(){$("#gConnect").hide()}function guidGenerator(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+""+e()+e()+e()+e()+e()+e()}function setId(){var e=guidGenerator();$("#firstRow").attr("id",e)}function addRow(){$(".table").find("tbody").append($('<tr id="'+guidGenerator()+'">').append($("<td>").append($('<input class="form-control" value="ga:pagePath==conversionista.se/" placeholder="ga:pagePath==example.com/" required />'))).append($('<td class="res0">').append($("<span>â€“</span>"))).append($("<td>").append($('<input class="form-control" value="ga:goal12Completions>0" placeholder="ga:pagePath==example.com/checkout" required />'))).append($('<td class="res1">').append($("<span>â€“</span>"))).append($("<td>").append($('<button class="btn btn-default btn-sm showGraph">Show Graph</button>'))).append($("<td>").append($('<button class="btn btn-link delete"><i class="fa fa-trash"></i></button>'))))}function deleteRow(e){var t="#"+e;swal({title:"Are you sure?",text:"This action can't be undone.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){$(t).remove(),swal({title:"Deleted!",text:"The row has been deleted.",type:"success",timer:1e3,showConfirmButton:!1})})}function addDeleteListener(){$("button.delete").on("click",function(){deleteRow($(this).parent().parent().attr("id"))})}function addGraphListener(){$(".showGraph").on("click",function(){$("#modalChart").modal();var e=$(this).parent().parent().attr("id");window.setTimeout(function(){renderChart(e)},500)})}function calculatePlot(e,t,o){var n=[],a=readLocal(e),r=a.u1,i=a.c1;return o===!0&&(r=a.u2,i=a.c2),$.each(t,function(e,t){var o=calculateMDU(r,i,t);n.push(100*o)}),n}function renderChart(e){var t=[1,2,3,4,5,7,8,9,10,11,12],o=readLocal(e),n=$("#chart"),a=calculatePlot(e,t,!1),r=calculatePlot(e,t,!0),i={labels:t,datasets:[{label:o.n1,tension:0,backgroundColor:"rgba(179,181,198,0.2)",borderColor:"rgba(179,181,198,1)",pointBackgroundColor:"rgba(179,181,198,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(179,181,198,1)",data:a},{label:o.n2,tension:0,backgroundColor:"rgba(255,99,132,0.2)",borderColor:"rgba(255,99,132,1)",pointBackgroundColor:"rgba(255,99,132,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(255,99,132,1)",data:r}]};new Chart(n,{type:"line",data:i,options:{tension:0,title:{display:!0,text:"Custom Chart Title"},defaultFontFamily:'"Source Sans Pro", "Helvetica Neue", Helvetica, Arial, sans-serif',scales:{xAxes:[{time:{unit:"week"}}]}}})}var len,queryData=[];$("body").loadie(),$(".loadie").fadeIn();var progress=.2;window.cookieconsent_options={message:"This website uses cookies to ensure you get the best experience.",dismiss:"Got it!",learnMore:"Read more.",link:"https://conversionista.se/kakor-och-personuppgifter/",theme:"dark-bottom"};var CLIENT_ID="608828753976-tempoconifjmq7mprinr4gmoqlpe6ce4.apps.googleusercontent.com",DISCOVERY="https://analyticsreporting.googleapis.com/$discovery/rest",SCOPES=["https://www.googleapis.com/auth/analytics.readonly","https://www.googleapis.com/auth/plus.me","https://www.googleapis.com/auth/plus.profile.emails.read"];$("#go").text("Loading..."),$(document).ready(function(){function e(){var e=!1;return window.File&&window.FileReader&&window.FileList&&window.Blob&&(e=!0),e}function t(t){if(e()){var o=null,n=t.target.files[0],a=new FileReader;a.readAsText(n),a.onload=function(e){var t=e.target.result;if(o=$.csv.toArrays(t),o&&o.length>0){console.info("Imported -"+o.length+"- rows successfully!");var n=makeArr(o);console.log(n),presentData(n),Math.abs(n.skewness)>=1?($("#headline").text(Math.round(n.traffic)),$("#byline").text("Based on the provided dataset (skewness: "+n.skewness+") you will need "+Math.round(n.traffic)+" instances for each variation.")):($("#headline").text(Math.round(355)),console.log("ðŸ˜ž"),$("#byline").text("The skewness of your data is less than 1 ("+n.skewness+"), therefor you should use another calculator to esitmate the length of your experiment."))}else console.info("No data to import!")},a.onerror=function(){alert("Unable to read "+n.fileName)}}else alert("The File APIs are not fully supported in this browser!")}document.getElementById("txtFileUpload").addEventListener("change",t,!1)}),$("#go").on("click",function(e){$(this).html('<i class="fa fa-cog fa-spin"></i>').attr("disabled",!0),getFormValues(),e.preventDefault()}),$("#accountId").on("change",function(){queryProperties(this.value),updateLocal("feasibility_calc","accountId",this.value)}),$("#propertyId").on("change",function(){queryProfiles($("#accountId").val(),this.value),updateLocal("feasibility_calc","propertyId",this.value)}),$("#profileId").on("change",function(){updateLocal("feasibility_calc","profileId",this.value)}),$(document).ready(function(){$(":checkbox").checkboxpicker(),$('[data-toggle="tooltip"]').tooltip()}),$("#getTransactions").on("click",function(e){e.preventDefault(),queryTransactions()}),setId(),$("#addRow").click(function(){addRow(),addDeleteListener(),addGraphListener()}),$(document).ready(function(){addGraphListener()}),$("#modalChart").on("show.bs.modal",function(e){window.setTimeout(function(){var e=$("#modalChart .modal-body").innerHeight(),t=$("#modalChart .modal-body").innerWidth();t-=40,$("#chart").attr("height",e).attr("width",t)},500)}),$("#save").on("click",function(){event.preventDefault();var e=[];$("table tbody tr").each(function(e,t){console.log($(t).attr("id"));var o=$(t).attr("id"),n="#"+o+" input";console.log("***");var a=[];$(n).each(function(e,t){console.log($(t).val()),a.push($(t).val())});var r=[];r[o]=a,console.log(r)}),swal({title:"An input!",text:"Write something interesting:",type:"input",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"Write something"},function(t){return t===!1?!1:""===t?(swal.showInputError("You need to write something!"),!1):(console.log(JSON.stringify(e)),saveLocal("fc_save_"+guidGenerator(),e),void swal("Nice!","You wrote: "+t,"success"))})});